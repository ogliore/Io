function SOL=Xs_from_T_P_allP(T,P)

do3=true;

XH2O=0;
XFeO=0.136;
XTiO2=0.0098;
XCaO=0.122;
XSiO2=0.732;
T=1700;
Xs_from_T_P = @(T,P) 1e2*exp(-1.76-0.474*1e4/T-0.021*(P*1e-8)+5.559*XFeO+2.565*XTiO2+2.709*XCaO-3.192*XSiO2-3.049*XH2O);

% % Gerlach 1986:
% P_T3 = [32.2, 30, 25, 20, 15, 10, 5, 3, 1.5, 1, 0.8, 0.6, 0.5, 0.4, 0.3, 0.2];
% Ws_T3= [0.0700, 0.0698, 0.0693, 0.0687, 0.0680, 0.0671, 0.0649, 0.0615, 0.0492, 0.0393, 0.0341, 0.0280, 0.0245, 0.0205, 0.0160, 0.0106];
% 


P_T4 = [84, 50, 40, 30, 25, 20, 15, 10, 5, 3, 1.5, 1, 0.8, 0.6, 0.5, 0.4, 0.3, 0.2];
Ws_T4= [0.0700, 0.0669, 0.0659, 0.0647, 0.0640, 0.0632, 0.0622, 0.0606, 0.0565, 0.0511, 0.0391, 0.0308, 0.0264, 0.0211, 0.0180, 0.0144, 0.0104, 0.0054];


P_T3 = [32.2, 30, 25, 20, 15, 10, 5, 3, 1.5, 1, 0.8, 0.6, 0.5, 0.4, 0.3, 0.2]*1e6;
Ws_T3= [0.0700, 0.0698, 0.0693, 0.0687, 0.0680, 0.0671, 0.0649, 0.0615, 0.0492, 0.0393, 0.0341, 0.0280, 0.0245, 0.0205, 0.0160, 0.0106];

if do3
    P_T=P_T3;
    Ws_T=Ws_T3;
else
    P_T=P_T4;
    Ws_T=Ws_T4;
end

PWfit=fit(P_T',Ws_T',fittype('A*exp(B*x)+C*exp(D*x)'),fitoptions('StartPoint',[0.0652 0.0000 -0.0651 0.0000],'Method', 'NonlinearLeastSquares'));


SOL(P>P_T(1))=Xs_from_T_P(T,P(P>=P_T(1)));
SOL(P<=P_T(1))=PWfit(P(P<=P_T(1))).*(Xs_from_T_P(T,P_T(1))./PWfit(P_T(1)));
%interp1([0,P_T],[0,Ws_T.*Xs_from_T_P(T,P_T(1))./Ws_T(1)],P(P<=P_T(1)),'linear');

%Lionel_quartic = @(P) 6.265596*1e-4.*(P.*1e-6) - 1.294010e-8.*(P.*1e-6).^2 - 1.094052e-10.*(P.*1e-6).^3 + 2.469919e-14.*(P.*1e-6).^4;
%SOL(P<=P_T(1))=(Xs_from_T_P(T,P_T(1))./Lionel_quartic(P_T(1))).*Lionel_quartic(P(P<=P_T(1)));

end